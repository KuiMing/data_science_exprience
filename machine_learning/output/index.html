<!doctype html>
<html>
  <head>
    <!-- Metadata about the presentation -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Machine Learning</title>

    <meta name="description" content="Data Science">
    <meta name="author" content="Kui-Ming Chen">

    <!-- Presentation Styles -->
    <link rel="stylesheet" href="static/revealjs/dist/reset.css">
    <link rel="stylesheet" href="static/revealjs/dist/reveal.css">

    
      <link rel="stylesheet" href="static/revealjs/dist/theme/black.css" id="theme">
    

    

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="static/revealjs/plugin/highlight/monokai.css" id="highlight-theme">
  </head>

  <body>
    <!-- Presentation body -->
    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        
          
            
              <section data-markdown>
                <textarea data-template>
                  # Machine Learning


                </textarea>
              </section>
            
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

![](media/solution_1.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    



## Machine Learning

- 非監督式學習
  - DBSCAN
- 監督式學習
  - K-Nearest Neighbors
  - Linear Regression
- 深度學習
  - LeNet
  - Face Recognition



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 取得教學範例

- machine learning
  - https://reurl.cc/DyOQ2d
- LeNet
  - https://reurl.cc/k1ojeb
- face recognition
  - https://reurl.cc/d2aj36



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 今日檔案

- 請先下載這些檔案，並上傳到Colab
  - 連結：https://reurl.cc/x9Ny4b
      - `tutorial_latlon.csv` 
      - `windy_power.csv`



                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

# DBSCAN

Density-based spatial clustering of applications with noise


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## POI

- Point Of Interesting
- GPS- Global Positioning System
- Geolocation: 
  - 緯度 latitude
  - 經度 longitude
- 資料都是從智慧型手機取得


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background-color="#ffffff" data-background-iframe="media/map.html" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


<!-- .slide: data-background="media/DBSCAN_principle.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## DBSCAN

![](media/DBSCAN.png)




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## DBSCAN


<img src="media/dbscan.gif" height="500px">


<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://ml-explained.com/blog/dbscan-explained</font>




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 觀察資料

```python
import pandas as pd
import numpy as np
from sklearn.cluster import DBSCAN
import folium
data = pd.read_csv("tutorial_latlon.csv")

loc_center = [data['lat'].mean(), data['lon'].mean()]
map_base = folium.Map(location = loc_center, tiles='Openstreetmap', 
                  zoom_start = 18, control_scale=True)
for index, loc in data.iterrows():
    folium.CircleMarker([loc['lat'], loc['lon']], 
                        radius=1, weight=5, color="black",
                        popup=f"{loc['lat']},{loc['lon']}").add_to(map_base)
map_base
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


<!-- .slide: data-background-color="#ffffff" data-background-iframe="media/map.html" -->




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 畫地圖 function

```python
def draw_map(data):
  loc_center = [data['lat'].mean(), data['lon'].mean()]
  map_base = folium.Map(location = loc_center, tiles='Openstreetmap', 
                    zoom_start = 18, control_scale=True)
  for index, loc in data.iterrows():
      folium.CircleMarker([loc['lat'], loc['lon']], 
                          radius=1, weight=5, color=loc['color'], 
                          popup=f"{loc['lat']},{loc['lon']}").add_to(map_base)
  return map_base
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 執行 DBSCAN

```python
db = DBSCAN(eps=3e-5, min_samples=10).fit(data.values)
data["label"] = db.labels_
data.label.unique()
```


```
array([ 0,  1,  2, -1])
# 0, 1, 2 代表不同分群，-1 代表無法分群
```

                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 畫圖觀察分群

```python
color = ["red", "green", "blue", "black"]
f = lambda x: color[int(x)] # 匿名函數
data["color"] = data.label.apply(f)
map_dbscan = draw_map(data)
map_dbscan
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background-color="#ffffff" data-background-iframe="media/dbscan_map.html" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 調整參數會如何？

改變 `eps`
```python
data = pd.read_csv("tutorial_latlon.csv")
db = DBSCAN(eps=3e-4, min_samples=10).fit(data.values)
data["label"] = db.labels_
color = ["red", "green", "blue", "black"]
f = lambda x: color[int(x)] # 匿名函數
data["color"] = data.label.apply(f)
map_dbscan = draw_map(data)
map_dbscan
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 經緯度對應的距離

![](media/degree.png)




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

![](media/POI.png)


                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

# K-Nearest Neighbors



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## K-Nearest Neighbors

- 計算待測資料與其他資料點之間的距離
- 選擇與待測資料最近的 K 個資料點
- 投票：算出 K 個資料點中，哪個類別出現最多次，出現最多次的類別作為待測資料的類別

![](media/knn.gif)





<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://medium.com/dropout-analytics/beginners-guide-to-knn-with-cuml-ddca099f9e9d</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Iris


![](media/iris_1.jpeg)



<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">http://mirlab.org/jang/books/dcpr/datasetiris.asp?title=2-2+iris+dataset&language=all</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Iris

![](media/iris_2.png)




<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://www.embedded-robotics.com/iris-dataset-classification/</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 讀取資料


```python

from sklearn.neighbors import KNeighborsClassifier
import pandas as pd
import numpy as np
from sklearn import datasets
from sklearn.model_selection import train_test_split
import plotly.express as px

iris = datasets.load_iris()
iris
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 畫圖觀察


```python
data = pd.DataFrame(iris.data, columns=iris.feature_names)
data["label"] = iris.target
f = lambda x: iris.target_names[x]
data["species"] = data.label.apply(f)
px.scatter(data, "petal length (cm)", "petal width (cm)", color="species")
px.scatter(data, "sepal length (cm)", "sepal width (cm)", color="species")
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 畫圖觀察

![](media/iris_3.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 畫圖觀察

![](media/iris_4.png)




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 執行 KNN


```python
# 分成 training 和 testing 資料
x_train, x_test, y_train, y_test = train_test_split(iris.data, iris.target, 
                                                    test_size=0.2, random_state=1)

# 訓練
knn = KNeighborsClassifier(n_neighbors=3,p=2)
knn.fit(x_train, y_train)
# 預測
pred_test = knn.predict(x_test)
pred_train = knn.predict(x_train)
```





                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 觀察分類結果

觀察正確率
```python
knn.score(x_train, y_train)
```
```
0.95
```
```python
knn.score(x_test, y_test)
```
```
1
```

                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 觀察分類結果
```python [1-8|9-13|14-17|18-19]
# 整理一下資料
data_knn = pd.DataFrame(
    np.append(x_train, x_test, axis=0), 
    columns=iris.feature_names)
data_knn['label'] = np.append(y_train, y_test, axis=0)
data_knn['training'] = ["train"] * len(x_train) + ["test"] * len(x_test)
data_knn["prediction"] = np.append(pred_train, pred_test, axis=0)

# 把分類錯誤的結果標示為 Wrong
f = lambda x: iris.target_names[x]
data_knn["answer"] = data_knn.label.apply(f)
data_knn.loc[data_knn["prediction"] - data_knn["label"] != 0, "answer"] = "Wrong"

# 把真實類別與預測結果另外處理
data_knn["species"] = data_knn.label.apply(f)
data_knn["prediction_species"] = data_knn.prediction.apply(f)

px.scatter(data_knn, "petal length (cm)", "petal width (cm)", 
           color="answer", hover_data=["species", "prediction_species"])

```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 觀察分類結果
![](media/knn_1.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 試著調整 K

```python [1-8 | 10-15 | 17]
# K 從 1 試到 99
accuracy_train = []
accuracy_test = []
for k in range(1, 100):
  knn = KNeighborsClassifier(n_neighbors=k)
  knn.fit(x_train, y_train)
  accuracy_train.append(knn.score(x_train, y_train))
  accuracy_test.append(knn.score(x_test, y_test))

# 整理結果
accuracy = pd.DataFrame(dict(
    k=list(range(1, 100)) * 2,
    accuracy=np.append(accuracy_train, accuracy_test),
    train=["train"] * 99 + ["test"] * 99
    ))

px.line(accuracy, x="k", y="accuracy", color="train", markers=True)
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 試著調整 K
![](media/knn_2.png)


                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

# Linear Regression



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

	
<!-- .slide: data-auto-animate -->

## 多少風力產生多少電力


![](media/windy_power.png)




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    
	
<!-- .slide: data-auto-animate -->

## 多少風力產生多少電力


![](media/windy_power_line.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-auto-animate -->


## 多少風力產生多少電力


![](media/windy_power_line.png)
- linear regression
- $y = b + a \times x$


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-auto-animate -->

## 多少風力產生多少電力

- linear regression
- $y = b + a \times x$
  - y: 電力, x: 風速
  - 求出 a 和 b- 斜率和截距



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 評估模型

- Loss function
- 找到讓誤差最小的參數
  - 最小平方法
  - <font color="red">Gradient Descent</font>


$$
Loss(a, b) = \sum _{i=1} ^n (Truth_i - y_i)^2 = \sum _{i=1} ^n (Truth_i - b + a \times x_i)^2
$$


$$
a^*, b^* = arg\ min\ Loss(a, b)
$$


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Gradient Descent


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/gradient_1.png" -->

                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


<!-- .slide: data-background="media/gradient_2.png" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/gradient_3.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 動手練習

```python
import pandas as pd
from sklearn.model_selection import train_test_split
from scipy.stats import linregress
import plotly.express as px
data = pd.read_csv("windy_power.csv")

fig = px.scatter(data, "wind_speed", "power")
fig.update_traces(mode='markers', marker_size=10) 

```

![](media/windy_power.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 動手練習
```python

x_train, x_test, y_train, y_test = train_test_split(
    data.wind_speed.values, data.power.values, test_size=0.2, random_state=0)
lr = linregress(x_train, y_train)

print(f"y = {lr.intercept} + {lr.slope} * x")
print(f"R squre: {lr.rvalue ** 2}")
```

```
y = -88525.52938319303 + 34285.52615057922 * x
R squre: 0.7875220416551721 
# 判定係數：表示產生電力的多寡有約78%受到風速快慢的直線關係影響
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 動手練習

```python
def lr_plot(x, y, prediction):
  df = pd.DataFrame(dict(wind_speed=x, power=y, prediction=prediction))
  fig = px.scatter(df, "wind_speed", "power") 
  fig_p = px.line(df, "wind_speed", "prediction", color_discrete_sequence=['red'], markers=True)
  fig.add_trace(fig_p.data[0])
  fig['data'][0]['showlegend']=True
  fig['data'][1]['showlegend']=True
  fig['data'][0]['name']='power'
  fig['data'][1]['name']='prediction'
  fig.update_traces(line_width=2, marker_size=10) 
  fig.show()

pred_train = lr_prediction(x_train, lr)
lr_plot(x_train, y_train, pred_train)
```

![](media/regression_1.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 動手練習
```python
pred_test = lr_prediction(x_test, lr)
lr_plot(x_test, y_test, pred_test)

```

![](media/regression_2.png)


                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

# LeNet


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## LeNet

- 讓電腦識字
- Deep Learning
  - Convolutional Neural Network, CNN
- Mnist dataset: 手寫文字資料集，0~9
  - 20000 筆資料，灰階圖形
  - 28 * 28 * 1 pixels 
  - Colab 內建資料


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## LeNet

![](media/Lenet.gif)



<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://gfycat.com/gifs/search/artificial+neural+networks</font>


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Mnist


<img src=media/mnist.png width="80%">


<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://machinelearningmastery.com/how-to-develop-a-convolutional-neural-network-from-scratch-for-mnist-handwritten-digit-classification/</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Mnist

```python
import pandas as pd
data = pd.read_csv("sample_data/mnist_train_small.csv", header=None)
data
```

![](media/mnist_data.png)



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Mnist

```python
from PIL import Image
import numpy as np
from skimage import io
import plotly.express as px
x_train = data.values[:, 1:].reshape(20000, 28, 28)
label = data.values[:, 0]
def show_number(data):
  array = data.astype(np.uint8)
  img = Image.fromarray(array)
  img.save("output.png")
  img = io.imread('output.png')
  fig = px.imshow(img, color_continuous_scale='gray')
  fig.update_xaxes(showticklabels=False)
  fig.update_yaxes(showticklabels=False)
  fig.show()
```

```python
show_number(x_train[305, :,:])
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    



<!-- .slide: data-background-iframe="media/mnist.html" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## LeNet


![](media/Lenet.png)





<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://medium.com/mlearning-ai/lenet-and-mnist-handwritten-digit-classification-354f5646c590</font>


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## LeNet

- Deep Learning- CNN
  - Layer
    - Convolution layer 
    - Maxpooling Layer
    - Dense Layer
  - Activation Function
    - tanh
    - softmax
  - Loss function
    - Cross Entropy



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## LeNet


```python

from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Deep Learning

- Based on Artificial Neural Network

![](media/neuron.png)




<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://www.researchgate.net/figure/A-diagram-showing-a-neuron-making-a-synaptic-connection-with-another-neuron_fig1_258023902</font>


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Deep Learning

![](media/neuron_connection.jpeg)


<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://www.quora.com/How-can-I-make-new-connections-between-the-neurons-of-my-brain</font>




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background-iframe="https://playground.tensorflow.org/" -->



<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://playground.tensorflow.org/</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Convolutional Neural Network- CNN

- LeNet
  - Convolution Layer 
  - Maxpooling Layer
  - Dense Layer




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Covolution Layer


![](media/Lenet_1.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Covolution Layer


![](media/cnn.png)



<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://medium.datadriveninvestor.com/convolutional-neural-networks-3b241a5da51e</font>




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Covolution Layer

![](media/cnn.gif)



<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://medium.datadriveninvestor.com/convolutional-neural-networks-3b241a5da51e</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Covolution Layer

```python [6,8]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Maxpooling Layer

![](media/Lenet_2.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Maxpooling Layer

![](output/media/Max_pooling.png)


<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://en.wikipedia.org/wiki/Convolutional_neural_network</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Maxpooling Layer

```python [7,9 | 10]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Dense Layer

![](media/Lenet_3.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


<!-- .slide: data-background-color="#ffffff" -->
## Dense Layer
Full-Connected Layer
![](media/Dense.svg)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Dense Layer


```python [11-13]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Activation Function

- 非線性
- 電路開關或閥門
- Example
  - tanh
    - hyperbolic tangent
    - 雙曲正切
  - Softmax


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Tanh

$$
tanh x = \frac{cosh x}{sinh x} = \frac{e^x - e^{-x}}{e^x + e^{-x}}
$$
![](media/tanh.png)


                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Tanh

```python [6, 8, 11-12]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## softmax

$$
\frac{e^{x_i}}{\sum _{i=1} ^{n} (e^{x_i})}
$$

- n 為分類數量
- 輸出為 0 ~ 1 之間
- 總和為 1
- 例如：假設有 A、B、C 三類，某一模型的輸出結果可能為 [0.1, 0.2, 0.7]，分別代表預測為此三類的機率，選擇機率高的作為答案，故將會預測為 C。


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    



## softmax

```python [13]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## One-Hot Encoding

- 以 0 和 1 表示，相對應的種類為 1，其他為 0
- 有幾個種類，就會有幾個數字
- 形成由 0 和 1 組成的數列
- 以上述數列作為標準答案，與預測結果相比，計算出 Loss

![](media/one_hot.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Cross Entropy

$$
\sum _{i=1} ^{n} - Truth_i \times log(Prediction_i)
$$

- Loss Function
- 觀察預測結果的機率分佈與真實情況的機率分佈之間的差異




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Cross Entropy- 極佳的情況
![](media/cross_entropy_2.png)

Loss = 
total cross entropy = 
$$
(- 1 \times log(0.99999)) +  (- 0 \times log(0.00001)) +
$$
$$
(- 0 \times log(0.00001)) + (- 1 \times log(0.99999)) = 
$$
$$
4.34 \times 10^{-6} \times 2 = $8.68 \times 10^{-6}
$$



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## Cross Entropy- 極糟的情況
![](media/cross_entropy_1.png)

Loss = 
total cross entropy = 
5 + 5  = 10





                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Cross Entropy

![](media/cross_entropy_3.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    



## Cross Entropy


```python [14-16|17-18|20-26]
from keras.models import Sequential, load_model
from keras.layers import Dense, LSTM, Dropout, Conv2D, MaxPooling2D, Flatten, Input
from tensorflow.keras.utils import to_categorical

model = Sequential()
model.add(Conv2D(filters=6, kernel_size=(5, 5), activation="tanh", input_shape=(28, 28, 1)))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Conv2D(filters=16, kernel_size=(5, 5), activation="tanh"))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Flatten())
model.add(Dense(120, activation="tanh"))
model.add(Dense(84, activation="tanh"))
model.add(Dense(10, activation="softmax"))
model.compile(
        optimizer="adam", loss="categorical_crossentropy", metrics=["accuracy"]
    )
x_train = x_train / 255 # Normalize
y_train = to_categorical(label) # One-hot encoding

model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```

                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Normalization



![](media/normalization.jpeg)

<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://towardsdatascience.com/how-to-calculate-the-mean-and-standard-deviation-normalizing-datasets-in-pytorch-704bd7d05f4c</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Training

```python
model.fit(
        x_train,
        y_train,
        epochs=10,
        validation_split=0.2,
        batch_size=10
    )
```

![](media/epoch.png)



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Testing

```python
test_data = pd.read_csv("sample_data/mnist_test.csv", header=None)
x_test = test_data.values[:,1:].reshape(-1, 28, 28)
x_test = x_test / 255
y_test = to_categorical(test_data.values[:, 0])
pred = model.predict(x_test[32,:,:].reshape(1,28,28,1))
np.argmax(pred)
```

```
3
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Testing

```python
show_number(x_test[32,:,:] * 255)
```

![](media/mnist_3.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Testing

```python
model.evaluate(x_test, y_test)
```
```
313/313 [==============================] - 4s 11ms/step - loss: 0.0637 - accuracy: 0.9800
[0.06365595757961273, 0.9800000190734863]
```


                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    



# Face Recognition



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    



### Face Recognition Flow

![](media/face_1.png)



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### Face Recognition Flow

- Server
  - 將需要辨識的人臉編碼，取得特徵向量
  - 將特徵向量存入資料庫
- Client
  - 取得人臉影像
  - 將人臉轉換成特徵向量
  - 與資料庫內的特徵向量比對
    - 歐氏距離


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 照片資料夾

- 登入自己的 Google Drive
- 產生一個 `photo` 資料夾
- 放進一些人物照片
- 照片檔名改成該照片中人物的名字



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 照片資料夾
![](media/photo.png)




<font size=2 color="#33C7FF" style="position: absolute; top: 650px; left: 50px">https://www.pexels.com/zh-tw/search/asian/</font>


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 照片限制
- 每張照片都應該只有一張臉，不可以無臉
- 有些照片無法辨識：
  - 太亮的影像，例如嚴重的背光
  - 眼睛被擋住
  - 臉型或髮型改變
  - 臉部外觀因為年齡的變化
  - 極端臉部表情
  - 頭部動作太大


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 安裝套件

```
!pip install face_recognition

```
- Use `dlib` library
- deep learning 
- Accuracy: 99.38% on the [Labeled Faces in the Wild](http://vis-www.cs.umass.edu/lfw/) benchmark.


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 掛載 google drive

```python
import glob
import pickle
import argparse
import face_recognition
import numpy as np
from google.colab import drive
# 將自己的雲端硬碟掛載上去
drive.mount('/content/gdrive')
files = glob.glob("gdrive/MyDrive/photo/*")


```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 建立 face encoding 資料集

```python
face_encodings = []
face_names = []
for img in files:
  image = face_recognition.load_image_file(img)
  encoding = face_recognition.face_encodings(image)
  face_encodings.append(encoding[0])
  face_names.append(img.replace("gdrive/MyDrive/photo/", "").split(".")[0])
```
請自行上傳自己的照片


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 測試新照片

請記得上傳自己的照片
```python
# 檔名記得改成自己照片的檔名，不要照抄
image = face_recognition.load_image_file("Ben_0525.png")
face_enco = face_recognition.face_encodings(image)
# 一一比對新照片的特徵向量與資料集之間的距離
distances = face_recognition.face_distance(face_encodings, face_enco[0])
# 選擇距離最小的名字
face_names[np.argmin(distances)]
```
```
Ben
```
                  </textarea>
                </section>
              
            </section>
          
        
      </div>

    </div>

    <!-- Reveal.js script -->
    <script src="static/revealjs/dist/reveal.js"></script>

    <!-- Reveal.js plugins -->
    <script src="static/revealjs/plugin/markdown/markdown.js"></script>
    <script src="static/revealjs/plugin/highlight/highlight.js"></script>
    <script src="static/revealjs/plugin/search/search.js"></script>
    <script src="static/revealjs/plugin/notes/notes.js"></script>
    <script src="static/revealjs/plugin/math/math.js"></script>
    <script src="static/revealjs/plugin/zoom/zoom.js"></script>

    <script>
      Reveal.initialize({
        math: {
          config: 'TeX-AMS_HTML-full',
          // pass other options into `MathJax.Hub.Config()`
          TeX: { Macros: { RR: "{\\bf R}" } }
        },
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealSearch,
          RevealNotes,
          RevealMath,
          RevealZoom
        ]
      });

      Reveal.configure({"autoAnimate": true, "autoAnimateDuration": 1.0, "autoAnimateEasing": "ease", "autoAnimateMatcher": null, "autoAnimateStyles": ["opacity", "color", "background-color", "padding", "font-size", "line-height", "letter-spacing", "border-width", "border-color", "border-radius", "outline", "outline-offset"], "autoAnimateUnmatched": true, "autoPlayMedia": true, "autoSlide": 0, "autoSlideMethod": null, "autoSlideStoppable": true, "backgroundTransition": "fade", "center": true, "controls": true, "controlsBackArrows": "faded", "controlsLayout": "bottom-right", "controlsTutorial": true, "defaultTiming": null, "disableLayout": false, "display": "block", "embedded": false, "focusBodyOnPageVisibilityChange": true, "fragmentInURL": true, "fragments": true, "hash": true, "hashOneBasedIndex": false, "help": true, "hideCursorTime": 5000, "hideInactiveCursor": true, "history": true, "keyboard": true, "keyboardCondition": null, "loop": false, "mobileViewDistance": 2, "mouseWheel": false, "navigationMode": "default", "overview": true, "pause": true, "pdfPageHeightOffset": -1, "pdfSeparateFragments": true, "postMessage": true, "postMessageEvents": false, "preloadIframes": true, "previewLinks": true, "progress": true, "respondToHashChanges": true, "rtl": false, "showNotes": false, "showSlideNumber": "all", "shuffle": false, "slideNumber": false, "touch": true, "transition": "slide", "transitionSpeed": "default", "viewDistance": 3});
    </script>
  </body>
</html>
